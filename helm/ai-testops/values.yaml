# Default values for ai-testops
# This is a YAML-formatted file.

namespace: testops

# Global image settings
image:
  pullPolicy: Always
  registry: docker.io

# Django settings
django:
  secretKey: "django-insecure-change-this-in-production-k8s-secret-key-12345"

# Django Application
djangoApp:
  name: django-app
  replicaCount: 1
  image:
    repository: vanlahuynhduc/ai-testops
    tag: "c8ee10d"
  service:
    type: ClusterIP
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "200m"
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 2
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

# Test Execute Consumer
consumer:
  name: test-execute-consumer
  replicaCount: 1
  image:
    repository: vanlahuynhduc/ai-testops-consumer
    tag: "c8ee10d"
  service:
    type: ClusterIP
    port: 8080
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  autoscaling:
    enabled: false  # Disable HPA for consumer - scale based on Kafka lag instead
    minReplicas: 2
    maxReplicas: 8
    targetCPUUtilizationPercentage: 70

# PostgreSQL Database
postgres:
  name: postgres
  image:
    repository: postgres
    tag: "13"
  service:
    type: ClusterIP
    port: 5432
  persistence:
    enabled: true
    size: 2Gi
    storageClass: "standard"  # Use 'standard' for Minikube/local, empty "" for default SC
  config:
    database: canvas_db
  credentials:
    username: canvas_user
    password: canvas_password
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# Kafka
kafka:
  name: kafka
  image:
    repository: apache/kafka
    tag: "3.9.0"
  service:
    type: ClusterIP
    port: 9092
  persistence:
    enabled: true
    size: 3Gi
    storageClass: "standard"  # Use 'standard' for Minikube/local, empty "" for default SC
  config:
    brokerId: 1
    replicationFactor: 1
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "400m"

# Zookeeper (disabled - using Kafka KRaft mode)
zookeeper:
  enabled: false
  name: zookeeper
  image:
    repository: wurstmeister/zookeeper
    tag: 20251203-084211-4900490
  service:
    type: ClusterIP
    port: 2181
  persistence:
    enabled: true
    size: 1Gi
    storageClass: "standard"  # Use 'standard' for Minikube/local, empty "" for default SC
  config:
    clientPort: 2181
    tickTime: 2000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Kafka UI
kafkaUI:
  name: kafka-ui
  enabled: false
  image:
    repository: provectuslabs/kafka-ui
    tag: "v0.7.2"
  service:
    type: ClusterIP
    port: 8080
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# Ingress
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      proxy_set_header X-Forwarded-Proto https;
      proxy_set_header X-Forwarded-Host $host;
  hosts:
    - host: testops.thduc.tech
      paths:
        - path: /
          pathType: Prefix
          service: django-app
          port: 8000
    - host: kafka-ui.testops.thduc.tech
      paths:
        - path: /
          pathType: Prefix
          service: kafka-ui
          port: 8080
  tls: []

# Security
rbac:
  enabled: true
  
networkPolicies:
  enabled: true

# Secrets (these should be overridden via values override or sealed secrets)
secrets:
  geminiApiKey: "YOUR_GEMINI_API_KEY_HERE"
  googleOauth2Key: ""
  googleOauth2Secret: ""
  grafanaCloudApiKey: ""

# Monitoring (optional)
monitoring:
  grafana:
    prometheusUrl: ""

# KEDA Autoscaling
keda:
  enabled: true
  pollingInterval: 30
  cooldownPeriod: 300
  consumer:
    minReplicas: 1
    maxReplicas: 10
    consumerGroup: "test-consumer-group"
    topic: "test_run_queue"
    lagThreshold: "10"
